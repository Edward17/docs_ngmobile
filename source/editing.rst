.. sectionauthor:: Дмитрий Барышников <dmitry.baryshnikov@nextgis.ru>

.. _editing:

Редактирование
==============

Если к карте были добавлены один или несколько векторных слоев, то их можно редактировать. При редактировании предоставляются возможности:

* добавить новую запись в слой;
* удалить запись из слоя;
* изменить запись в слое.

Существует несколько способов попасть в режим редактирования. Первый способ - это основная кнопка программы (большая синяя кнопка в правом нижнем углу). При нажатии на кнопку открывается меню наиболее часто используемых действий (см. :numref:`fab_pic`).


.. figure:: _static/ngmobile_fab.png
   :name: fab_pic
   :align: center
   :scale: 40 %
   
   Меню редактирования.

Меню имеет следующий состав:

* добавить линию или полигон обходом;
* добавить геометрию;
* добавить текущее местоположение.

Второй способ - это долгим нажатием на геометрию на экране вызвать режим выбора (см. :numref:`selectmode_pic`) и в нижней панели инструментов активировать команду "редактировать".


Добавление текущего местоположения
----------------------------------

Для добавления текущего местоположения в векторный слой, необходимо выбрать соответствующий пункт меню (см. :numref:`fab_pic`). Таким образом можно добавлять только точки или мультиточки с одной точкой. При этом, вначале открывается диалог выбора слоя в котором отображаются только точечные и мультиточенчые слои (см. :numref:`select_layer_dialog_pic`). 

.. figure:: _static/ngmobile_selectlayer.png
   :name: select_layer_dialog_pic
   :align: center
   :scale: 40 %
   
   Диалог выбора слоя.

После выбора слоя открывается форма редактирования атрибутов (см. :numref:`attributes_edit_pic`). 

.. figure:: _static/ngmobile_edit_attributes.png
   :name: attributes_edit_pic
   :align: center
   :scale: 55 %
   
   Окно редактирования атрибутов.
   
   Цифрами обозначено: 1 - возврат к предыдущему экрану; 2 - сохранение изменений; 3 - отмена изменений; 4 - меню дополнительных операций.

.. note::
   Диалог выбора слоя отображается только если слоев несколько. Если подходящий слой один то сразу открывается форма редактирования атрибутов.
   
Если слою сопоставлена настраиваемая форма, то будет открыта именно она.

После заполнения всех необходимых атрибутов необходимо нажать кнопку :numref:`attributes_edit_pic` п. 2 для сохранения изменений. При выборе кнопки 1 или 3 происходит возврат к окну карты без сохранения атрибутов. Точка также не будет добавлена.


Добавление геометрии
--------------------

Для добавления геометрии в векторный слой, необходимо выбрать соответствующий пункт меню (см. :numref:`fab_pic`). Таким образом можно добавлять любые типы геометрий (точки, линии, полигоны, мультиточки, мультилинии, мультиполигоны). При этом, вначале открывается диалог выбора слоя (см. :numref:`select_layer_dialog_pic`). В зависимости от выбранного слоя отображается соответствующее тулбар редактора.

Редактирование точки
^^^^^^^^^^^^^^^^^^^^

В режиме редактирования точки открывается нижняя панель инструментов, представленный на :numref:`edit_point_pic`.

.. figure:: _static/ngmobile_edit_point.png
   :name: edit_point_pic
   :align: center
   :scale: 55 %
   
   Панель инструментов редактирования точки.
   
   Цифрами обозначено: 1 - завершение режима редактирования; 2 - добавить новую точку; 3 - удалить точку; 4 - переместить точку в центр экрана; 5 - переместить точку в текущее местоположение; 6 - редактирование атрибутов.
   
Пользователь может выбрать имеющуюся точку в слое (она будет подсвечена красным цветом) или создать новую (новая точка будет создана в центре экрана и подсвечена красным светом. Далее выделенную точку можно смещать просто потянув ее или указывающую на нее стрелку. Кроме того, точку можно сместить в центр экрана или в текущее местоположение, выбрав соответствующие команды в нижней панели инструментов. 
     
При внесении изменений в слой кнопка 1 (см. :numref:`edit_point_pic`) изменяет совой значок. При этом, при нажатии на нее происходит сохранение измененной геометрии или создание новой геометрии и открытии диалога изменений атрибутов (см. :numref:`attributes_edit_pic`). 

.. note::

   Если диалог закрыть без применений изменений (без выбора п. 2 :numref:`attributes_edit_pic`), то запись будет все равно создана или изменена, но будет содержать только новую геометрию.

Для отмены сделанных правок служит кнопка ...

Если пользователь выбрал другую точку, то будет выведен диалог с предложением сохранить изменения в текущей геометрии или отменить правки. При выборе варианта сохранить изменения откроется окно изменения атрибутов (см. :numref:`attributes_edit_pic`).

Редактирование мультиточки
^^^^^^^^^^^^^^^^^^^^^^^^^^


Редактирование линии
^^^^^^^^^^^^^^^^^^^^


Редактирование полигона
^^^^^^^^^^^^^^^^^^^^^^^


Добавление линии или полигона обходом
-------------------------------------

